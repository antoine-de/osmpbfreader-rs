<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `osmpbfreader` crate.">
    <meta name="keywords" content="rust, rustlang, rust-lang, osmpbfreader">

    <title>osmpbfreader - Rust</title>

    <link rel="stylesheet" type="text/css" href="../normalize.css">
    <link rel="stylesheet" type="text/css" href="../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../main.css">
    

    
    
</head>
<body class="rustdoc mod">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'>Crate osmpbfreader</p><div class="block items"><ul><li><a href="#reexports">Reexports</a></li><li><a href="#modules">Modules</a></li></ul></div><p class='location'></p><script>window.sidebarCurrent = {name: 'osmpbfreader', ty: 'mod', relpath: '../'};</script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content">
<h1 class='fqn'><span class='in-band'>Crate <a class="mod" href=''>osmpbfreader</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a class='srclink' href='../src/osmpbfreader/lib.rs.html#8-128' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>This crate provide an interface to easily read <a href="http://wiki.openstreetmap.org/wiki/PBF_Format">OpenStreetMap PBF
files</a>.  Its main
inspiration is
<a href="https://github.com/CanalTP/libosmpbfreader">libosmpbfreader</a>.</p>

<h1 id='getting-objects-and-their-dependencies' class='section-header'><a href='#getting-objects-and-their-dependencies'>Getting objects and their dependencies</a></h1>
<p>Most of the time, you&#39;ll want a subset of the OSM objects and its
dependencies (i.e. the nodes inside a way, and not only the ids of
the nodes of this way).  For that, an easy to use function is
availlable.</p>

<pre class="rust rust-example-rendered">
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">pbf</span> <span class="op">=</span> <span class="ident">osmpbfreader</span>::<span class="ident">OsmPbfReader</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Cursor</span>::<span class="ident">new</span>([]));
<span class="kw">let</span> <span class="ident">objs</span> <span class="op">=</span> <span class="ident">pbf</span>.<span class="ident">get_objs_and_deps</span>(<span class="op">|</span><span class="ident">obj</span><span class="op">|</span> {
        <span class="ident">obj</span>.<span class="ident">is_way</span>() <span class="op">&amp;&amp;</span> <span class="ident">obj</span>.<span class="ident">tags</span>().<span class="ident">contains_key</span>(<span class="string">&quot;highway&quot;</span>)
    })
    .<span class="ident">unwrap</span>();
<span class="kw">for</span> (<span class="ident">id</span>, <span class="ident">obj</span>) <span class="kw">in</span> <span class="kw-2">&amp;</span><span class="ident">objs</span> {
    <span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;{:?}: {:?}&quot;</span>, <span class="ident">id</span>, <span class="ident">obj</span>);
}</pre>

<h1 id='readding' class='section-header'><a href='#readding'>Readding</a></h1>
<p>The easiest way to read a PBF file is to directly iterate on the
<code>OsmObj</code>.</p>

<pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">process</span>::<span class="ident">exit</span>;
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">pbf</span> <span class="op">=</span> <span class="ident">osmpbfreader</span>::<span class="ident">OsmPbfReader</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">empty</span>());
<span class="kw">for</span> <span class="ident">obj</span> <span class="kw">in</span> <span class="ident">pbf</span>.<span class="ident">iter</span>() {
    <span class="comment">// error handling:</span>
    <span class="kw">let</span> <span class="ident">obj</span> <span class="op">=</span> <span class="ident">obj</span>.<span class="ident">unwrap_or_else</span>(<span class="op">|</span><span class="ident">e</span><span class="op">|</span> {<span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;{:?}&quot;</span>, <span class="ident">e</span>); <span class="ident">exit</span>(<span class="number">1</span>)});

    <span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;{:?}&quot;</span>, <span class="ident">obj</span>);
}</pre>

<p>There is also a parallel version of this iterator. The file is
decoded in parallel.</p>

<pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">process</span>::<span class="ident">exit</span>;
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">pbf</span> <span class="op">=</span> <span class="ident">osmpbfreader</span>::<span class="ident">OsmPbfReader</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">empty</span>());
<span class="kw">for</span> <span class="ident">obj</span> <span class="kw">in</span> <span class="ident">pbf</span>.<span class="ident">par_iter</span>() {
    <span class="comment">// error handling:</span>
    <span class="kw">let</span> <span class="ident">obj</span> <span class="op">=</span> <span class="ident">obj</span>.<span class="ident">unwrap_or_else</span>(<span class="op">|</span><span class="ident">e</span><span class="op">|</span> {<span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;{:?}&quot;</span>, <span class="ident">e</span>); <span class="ident">exit</span>(<span class="number">1</span>)});

    <span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;{:?}&quot;</span>, <span class="ident">obj</span>);
}</pre>

<h1 id='into-the-details' class='section-header'><a href='#into-the-details'>Into the details</a></h1>
<p>This crate is build around basic iterators on different parts of
the structure of the PBF format.  Then, several higher level
iterator are proposed.  It is then possible to iterate on the file
using the low level iterators.</p>

<pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">osmpbfreader</span>::{<span class="ident">primitive_block_from_blob</span>, <span class="ident">groups</span>};
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">pbf</span> <span class="op">=</span> <span class="ident">osmpbfreader</span>::<span class="ident">OsmPbfReader</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">empty</span>());
<span class="kw">for</span> <span class="ident">block</span> <span class="kw">in</span> <span class="ident">pbf</span>.<span class="ident">blobs</span>().<span class="ident">map</span>(<span class="op">|</span><span class="ident">b</span><span class="op">|</span> <span class="ident">primitive_block_from_blob</span>(<span class="kw-2">&amp;</span><span class="ident">b</span>.<span class="ident">unwrap</span>())) {
    <span class="kw">let</span> <span class="ident">block</span> <span class="op">=</span> <span class="ident">block</span>.<span class="ident">unwrap</span>();
    <span class="kw">for</span> <span class="ident">group</span> <span class="kw">in</span> <span class="ident">block</span>.<span class="ident">get_primitivegroup</span>().<span class="ident">iter</span>() {
        <span class="kw">for</span> <span class="ident">node</span> <span class="kw">in</span> <span class="ident">groups</span>::<span class="ident">simple_nodes</span>(<span class="kw-2">&amp;</span><span class="ident">group</span>, <span class="kw-2">&amp;</span><span class="ident">block</span>) {
            <span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;{:?}&quot;</span>, <span class="ident">node</span>);
        }
        <span class="kw">for</span> <span class="ident">node</span> <span class="kw">in</span> <span class="ident">groups</span>::<span class="ident">dense_nodes</span>(<span class="kw-2">&amp;</span><span class="ident">group</span>, <span class="kw-2">&amp;</span><span class="ident">block</span>) {
            <span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;{:?}&quot;</span>, <span class="ident">node</span>);
        }
        <span class="kw">for</span> <span class="ident">way</span> <span class="kw">in</span> <span class="ident">groups</span>::<span class="ident">ways</span>(<span class="kw-2">&amp;</span><span class="ident">group</span>, <span class="kw-2">&amp;</span><span class="ident">block</span>) {
            <span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;{:?}&quot;</span>, <span class="ident">way</span>);
        }
        <span class="kw">for</span> <span class="ident">relation</span> <span class="kw">in</span> <span class="ident">groups</span>::<span class="ident">relations</span>(<span class="kw-2">&amp;</span><span class="ident">group</span>, <span class="kw-2">&amp;</span><span class="ident">block</span>) {
            <span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;{:?}&quot;</span>, <span class="ident">relation</span>);
        }
    }
}</pre>

<p>Notice that <code>primitive_block_from_blob</code> can be costy as it
uncompress the blob.  Using some kind of parallel map can then
improve the reading speed of the PBF file.</p>
</div><h2 id='reexports' class='section-header'><a href="#reexports">Reexports</a></h2>
<table><tr><td><code>pub use <a class="mod" href="../osmpbfreader/objects/index.html" title="mod osmpbfreader::objects">objects</a>::*;</code></td></tr><tr><td><code>pub use error::<a class="enum" href="../osmpbfreader/error/enum.Error.html" title="enum osmpbfreader::error::Error">Error</a>;</code></td></tr><tr><td><code>pub use error::<a class="type" href="../osmpbfreader/error/type.Result.html" title="type osmpbfreader::error::Result">Result</a>;</code></td></tr><tr><td><code>pub use reader::<a class="struct" href="../osmpbfreader/reader/struct.OsmPbfReader.html" title="struct osmpbfreader::reader::OsmPbfReader">OsmPbfReader</a>;</code></td></tr><tr><td><code>pub use reader::<a class="fn" href="../osmpbfreader/reader/fn.primitive_block_from_blob.html" title="fn osmpbfreader::reader::primitive_block_from_blob">primitive_block_from_blob</a>;</code></td></tr></table><h2 id='modules' class='section-header'><a href="#modules">Modules</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class="mod" href="blobs/index.html"
                                  title='mod osmpbfreader::blobs'>blobs</a></td>
                           <td class='docblock-short'>
                                <p>Iterator and utilities for <code>fileformat::Blob</code>.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="mod" href="blocks/index.html"
                                  title='mod osmpbfreader::blocks'>blocks</a></td>
                           <td class='docblock-short'>
                                <p>Iterators of OpenStreetMap objects from a block.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="mod" href="error/index.html"
                                  title='mod osmpbfreader::error'>error</a></td>
                           <td class='docblock-short'>
                                
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="mod" href="fileformat/index.html"
                                  title='mod osmpbfreader::fileformat'>fileformat</a></td>
                           <td class='docblock-short'>
                                <p>Generated from protobuf.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="mod" href="groups/index.html"
                                  title='mod osmpbfreader::groups'>groups</a></td>
                           <td class='docblock-short'>
                                
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="mod" href="objects/index.html"
                                  title='mod osmpbfreader::objects'>objects</a></td>
                           <td class='docblock-short'>
                                <p>This module proposes objects to modelize OpenStreetMap objects.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="mod" href="osmformat/index.html"
                                  title='mod osmpbfreader::osmformat'>osmformat</a></td>
                           <td class='docblock-short'>
                                <p>Generated from protobuf.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="mod" href="reader/index.html"
                                  title='mod osmpbfreader::reader'>reader</a></td>
                           <td class='docblock-short'>
                                <p>Tools for reading a pbf file.</p>
                           </td>
                       </tr></table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../";
        window.currentCrate = "osmpbfreader";
    </script>
    <script src="../main.js"></script>
    <script defer src="../search-index.js"></script>
</body>
</html>