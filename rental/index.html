<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `rental` crate.">
    <meta name="keywords" content="rust, rustlang, rust-lang, rental">

    <title>rental - Rust</title>

    <link rel="stylesheet" type="text/css" href="../normalize.css">
    <link rel="stylesheet" type="text/css" href="../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../main.css">
    

    
    
</head>
<body class="rustdoc mod">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'>Crate rental</p><div class="block items"><ul><li><a href="#modules">Modules</a></li><li><a href="#macros">Macros</a></li><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li><li><a href="#types">Type Definitions</a></li></ul></div><p class='location'></p><script>window.sidebarCurrent = {name: 'rental', ty: 'mod', relpath: '../'};</script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content">
<h1 class='fqn'><span class='in-band'>Crate <a class="mod" href=''>rental</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a class='srclink' href='../src/rental/lib.rs.html#1-330' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>A macro to generate self-referntial structs.</p>

<h1 id='overview' class='section-header'><a href='#overview'>Overview</a></h1>
<p>It can sometimes occur in the course of designing an API that it would be convenient, or even necessary, to allow fields within a struct to hold references to other fields within that same struct. Rust&#39;s concept of ownership and borrowing is quite flexible, but can&#39;t quite express such a scenario yet.</p>

<p>Creating such a struct manually requires unsafe code to erase lifetime parameters from the field types. Accessing such a field directly would be completely unsafe as a result. This library addresses the issue by allowing access to the internal fields only under carefully controlled circumstances, through closures that are bounded by generic lifetimes to prevent infiltration or exfiltration of any data with an incorrect lifetime.</p>

<p>The API of this crate consists of the <a href="macro.rental.html"><code>rental</code></a> macro, which generates self-referential structs, and a few example instantiations to demonstrate the API provided by such structs (see <a href="examples/struct.RentRef.html"><code>RentRef</code></a>, <a href="examples/struct.RentMut.html"><code>RentMut</code></a>, <a href="examples/struct.RentRefMap.html"><code>RentRefMap</code></a>, and <a href="examples/struct.RentMutMap.html"><code>RentMutMap</code></a>).</p>

<h1 id='use-cases' class='section-header'><a href='#use-cases'>Use Cases</a></h1>
<p>One instance where this crate is useful is when working with <code>libloading</code>. That crate provides a <code>Library</code> struct that defines methods to borrow <code>Symbol</code>s from it. These symbols are bounded by the lifetime of the library, and are thus considered a borrow. Under normal circumstances, one would be unable to store both the library and the symbols within a single struct, but the macro defined in this crate allows you to define a struct that is capable of storing both simultaneously, like so:</p>

<pre class="rust rust-example-rendered">
<span class="macro">rental</span><span class="macro">!</span> {
    <span class="kw">pub</span> <span class="kw">mod</span> <span class="ident">rent_libloading</span> {
        <span class="kw">use</span> <span class="ident">libloading</span>;
 
        <span class="attribute">#[<span class="ident">rental</span>(<span class="ident">deref_suffix</span>)]</span> <span class="comment">// This struct will deref to the target of Symbol.</span>
        <span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">RentSymbol</span><span class="op">&lt;</span><span class="ident">S</span>: <span class="lifetime">&#39;static</span><span class="op">&gt;</span> {
            <span class="ident">lib</span>: <span class="ident">Box</span><span class="op">&lt;</span><span class="ident">libloading</span>::<span class="ident">Library</span><span class="op">&gt;</span>, <span class="comment">// Library is boxed for stable deref.</span>
            <span class="ident">sym</span>: <span class="ident">libloading</span>::<span class="ident">Symbol</span><span class="op">&lt;</span><span class="lifetime">&#39;lib</span>, <span class="ident">S</span><span class="op">&gt;</span>, <span class="comment">// The &#39;lib lifetime borrows lib.</span>
        }
    }
}
 
<span class="kw">fn</span> <span class="ident">main</span>() {
    <span class="kw">let</span> <span class="ident">lib</span> <span class="op">=</span> <span class="ident">libloading</span>::<span class="ident">Library</span>::<span class="ident">new</span>(<span class="string">&quot;my_lib.so&quot;</span>).<span class="ident">unwrap</span>(); <span class="comment">// Open our dylib.</span>
    <span class="kw">if</span> <span class="kw">let</span> <span class="prelude-val">Ok</span>(<span class="ident">rs</span>) <span class="op">=</span> <span class="ident">rent_libloading</span>::<span class="ident">RentSymbol</span>::<span class="ident">try_new</span>(
        <span class="ident">Box</span>::<span class="ident">new</span>(<span class="ident">lib</span>),
        <span class="op">|</span><span class="ident">lib</span><span class="op">|</span> <span class="kw">unsafe</span> { <span class="ident">lib</span>.<span class="ident">get</span>::<span class="op">&lt;</span><span class="kw">extern</span> <span class="string">&quot;C&quot;</span> <span class="kw">fn</span>()<span class="op">&gt;</span>(<span class="string">b&quot;my_symbol&quot;</span>) }) <span class="comment">// Loading Symbols is unsafe.</span>
    {
        (<span class="kw-2">*</span><span class="ident">rs</span>)(); <span class="comment">// Call our function</span>
    };
}</pre>

<p>In this way we can store both the <code>Library</code> and the <code>Symbol</code> that borrows it in a single struct. We can even tell our struct to deref to the function pointer itself so we can easily call it. This is legal because the function pointer does not contain any of the special lifetimes introduced by the rental struct in its type signature, which means reborrowing will not expose them to the outside world. As an aside, the <code>unsafe</code> block for loading the symbol is necessary because the act of loading a symbol from a dylib is unsafe, and is unrelated to rental.</p>

<h1 id='limitations' class='section-header'><a href='#limitations'>Limitations</a></h1>
<p>There are a few limitations with the current implementation. These limitations aren&#39;t fundamental, but rather the result of bugs or pending features in rust itself, and will be lifted once the underlying language allows it.</p>

<ul>
<li>Currently, the rental struct itself can only take lifetime parameters under certain conditions. These conditions are difficult to fully describe, but in general, a lifetime param of the rental struct itself must appear &quot;outside&quot; of any special rental lifetimes in the type signatures of the struct fields. To put it another way, replacing the rental lifetimes with <code>&#39;static</code> must still produce legal types, otherwise it will not compile. In most situations this is fine, since most of the use cases for this library involve erasing all of the lifetimes anyway, but there&#39;s no reason why the head element of a rental struct shouldn&#39;t be able to take arbitrary lifetime params. This is currently impossible to fully support due to lack of an <code>&#39;unsafe</code> lifetime or equivalent feature.</li>
<li>Prefix fields must be of the form <code>Foo&lt;T&gt;</code> where <code>Foo</code> is some <code>StableDeref</code> container, or rental will not be able to correctly guess the <code>Deref::Target</code> of the type. If you are using a custom type that does not fit this pattern, you can use the <code>target_ty_hack</code> attribute on the field to manually specify the target type. This limitation can be lifted once rust gets ATC or possibly after current bugs surrounding HRTB associated item unification are fixed. The requirement for <code>StableDeref</code> at all can possibly be lifted if rust gains a notion of immovable types.</li>
<li>Rental structs can only have a maximum of 32 rental lifetimes, including transitive rental lifetimes from subrentals. This limitation is the result of needing to implement a new trait for each rental arity. More traits can easily be defined though. Lifting this limitation entirely would require some kind of variadic lifetime generics.</li>
<li>The references received in the constructor closures don&#39;t currently have their lifetime relationship expressed in bounds. This is currently not possible until the trait system refactor lands. This is not a soundness hole, but it does prevent some otherwise valid uses from compiling.</li>
</ul>
</div><h2 id='modules' class='section-header'><a href="#modules">Modules</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class="mod" href="examples/index.html"
                                  title='mod rental::examples'>examples</a></td>
                           <td class='docblock-short'>
                                <p>Example instantiations that demonstrate the API provided by the types this crate generates.</p>
                           </td>
                       </tr></table><h2 id='macros' class='section-header'><a href="#macros">Macros</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class="macro" href="macro.rental.html"
                                  title='macro rental::rental'>rental</a></td>
                           <td class='docblock-short'>
                                <p>The core of this crate, this macro will generate self-referential structs.</p>
                           </td>
                       </tr></table><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class="struct" href="struct.TryNewError.html"
                                  title='struct rental::TryNewError'>TryNewError</a></td>
                           <td class='docblock-short'>
                                <p>An error wrapper returned by the <code>try_new</code> method of a rental struct.</p>
                           </td>
                       </tr></table><h2 id='traits' class='section-header'><a href="#traits">Traits</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class="trait" href="trait.IntoSuffix.html"
                                  title='trait rental::IntoSuffix'>IntoSuffix</a></td>
                           <td class='docblock-short'>
                                <p>This trait converts any <code>*_Borrow</code> or <code>*_BorrowMut</code> structs generated by the <a href="macro.rental.html"><code>rental</code></a> macro into their suffix (most dependent) field.</p>
                           </td>
                       </tr></table><h2 id='types' class='section-header'><a href="#types">Type Definitions</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class="type" href="type.TryNewResult.html"
                                  title='type rental::TryNewResult'>TryNewResult</a></td>
                           <td class='docblock-short'>
                                
                           </td>
                       </tr></table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../";
        window.currentCrate = "rental";
    </script>
    <script src="../main.js"></script>
    <script defer src="../search-index.js"></script>
</body>
</html>